(()=>{var e={320(e,t,r){var a=r(22);e.exports={config:{secretKey:"/*__PROJECT_SECRET_KEY__*/"},defaultState:{inventory:[],stats:{charm:10,intelligence:10,strength:10},current_time:"2025-06-01T12:00:00Z",turn_count:0,current_side_effects:[]},summaryTemplate:{drink_alcohol:{what:"an allowed value describing what the user drank",when:"ISO standard date/time string without timezone",temp:!0,impacts:{intelligence:0,charm:0},duration:"PT1H",free_text:a}},standardizedFunctions:[function(e,t,r,a){var n="Current Time: "+e.data.current_time+"\\n";if(n+="Active Effects:\\n",0===e.data.current_side_effects.length)n+="- None\\n";else for(var i=0;i<e.data.current_side_effects.length;i++){var s=e.data.current_side_effects[i];n+="- "+s.what+" (Expires: "+s.expiry+")\\n"}return n+="Current Stats: "+JSON.stringify(e.data.stats)+"\\n"},function(e,t,r,a){return""}]}},22(e){"use strict";e.exports="allowed values are 'beer', 'wine' and 'liquor'. Duration should be set logically for a young woman (1 - 2 hours). Intelligence is reduced by 2 and charm is increased by 1 for 'beer' and 'wine', and intelligence is reduced by 1 and charm is increased by 2 for 'liquor'.\n"}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){for(var r,a,n=String(t),i="",s=0,o=e.chars;n.charAt(0|s)||(o="=",s%1);i+=o.charAt(63&r>>8-s%1*8)){if((a=n.charCodeAt(s+=3/4))>255)throw new Error("'base64.encode' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|a}return i},decode:function(t){var r=String(t).replace(/[=]+$/,"");if(r.length%4==1)throw new Error("'base64.decode' failed: The string to be decoded is not correctly encoded.");for(var a,n,i="",s=0,o=0;n=r.charAt(o++);~n&&(a=s%4?64*a+s:s,s++%4)?i+=String.fromCharCode(255&a>>(-2*s&6)):0)n=e.chars.indexOf(n);return i}},t="function"==typeof btoa?btoa:e.encode,a="function"==typeof atob?atob:e.decode,n=function(e,r){try{for(var a="",n=0;n<e.length;n++)a+=String.fromCharCode(e.charCodeAt(n)^r.charCodeAt(n%r.length));return t(a)}catch(e){return console.error("Encryption failed:",e),""}},i=function(e,t){try{for(var r=a(e),n="",i=0;i<r.length;i++)n+=String.fromCharCode(r.charCodeAt(i)^t.charCodeAt(i%t.length));return n}catch(e){return console.error("Decryption failed:",e),null}},s=function(e,t){var r=new Date(e),a=t.match(/P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)W)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?)?/);if(a){var n=parseInt(a[1]||0),i=parseInt(a[2]||0),s=parseInt(a[3]||0),o=parseInt(a[4]||0),c=parseInt(a[5]||0),d=parseInt(a[6]||0),u=parseInt(a[7]||0);r.setFullYear(r.getFullYear()+n),r.setMonth(r.getMonth()+i),r.setDate(r.getDate()+7*s+o),r.setHours(r.getHours()+c),r.setMinutes(r.getMinutes()+d),r.setSeconds(r.getSeconds()+u)}return r.toISOString().split(".")[0]+"Z"},o=function(e,t){return new Date(e)<=new Date(t)},c=function(e){var t=new Date(e),r=function(e){return(e<10?"0":"")+e},a=t.getUTCFullYear()+"-"+r(t.getUTCMonth()+1)+"-"+r(t.getUTCDate()),n=t.getUTCHours(),i=n>=12?"PM":"AM",s=r(n%12||12)+":"+r(t.getUTCMinutes())+":"+r(t.getUTCSeconds())+" "+i;return a+" ("+t.toLocaleDateString("en-US",{weekday:"long",timeZone:"UTC"})+") "+s};function d(e,t){for(var r=0,a=0;a<e;a++)r+=Math.floor(Math.random()*t)+1;return r}var u=r(320),f=r.n(u);var h={secretKey:f().config.secretKey,defaultState:f().defaultState},l={summaryTemplate:f().summaryTemplate||{},standardizedFunctions:f().standardizedFunctions||[]};"undefined"!=typeof context&&function(e){e.character||(e.character={}),e.character.scenario||(e.character.scenario=""),"string"!=typeof e.character.scenario&&(e.character.scenario=""),e.character.personality||(e.character.personality="");var t,r=function(){if(!e.chat||!e.chat.messages||0===e.chat.messages.length)return null;var t=e.chat.messages[e.chat.messages.length-1].message,r=t.match(/\[SCRIPT_SECRET\]([\s\S]*?)\[\/SCRIPT_SECRET\]/),a=null;if(r){var n=i(r[1],h.secretKey);if(n)try{a=JSON.parse(n)}catch(e){console.error("Failed to parse secret JSON",e)}}var s=t.match(/\[NARRATION_SUMMARY\]([\s\S]*?)\[\/NARRATION_SUMMARY\]/),o=null;if(s)try{o=JSON.parse(s[1])}catch(e){console.error("Failed to parse summary JSON",e)}return{secretData:a,summaryData:o}}()||{},a=(t=r.secretData||h.defaultState,{data:JSON.parse(JSON.stringify(t)),updateTime:function(e){e&&(this.data.current_time=s(this.data.current_time,e))},applySideEffect:function(e){var t=s(this.data.current_time,e.duration||"PT0M");for(var r in e.impacts)void 0!==this.data.stats[r]&&(this.data.stats[r]+=e.impacts[r]);var a={};for(var n in e)a[n]=e[n];a.expiry=t,this.data.current_side_effects.push(a),this.data.current_side_effects.sort(function(e,t){return new Date(e.expiry)-new Date(t.expiry)})},revertExpiredEffects:function(){for(var e=[],t=[],r=0;r<this.data.current_side_effects.length;r++){var a=this.data.current_side_effects[r];if(o(a.expiry,this.data.current_time)){for(var n in a.impacts)void 0!==this.data.stats[n]&&(this.data.stats[n]-=a.impacts[n]);t.push("Effect expired: "+a.what)}else e.push(a)}return this.data.current_side_effects=e,t}});a.data.turn_count++;var u=[];if(r.summaryData){r.summaryData.elapsed_duration&&a.updateTime(r.summaryData.elapsed_duration);var f=a.revertExpiredEffects();u=u.concat(f);var p=l.summaryTemplate;for(var m in r.summaryData)if(p[m]&&Array.isArray(r.summaryData[m]))for(var y=r.summaryData[m],S=p[m],T=0;T<y.length;T++){var g=y[T];if(S.impacts)for(var v in S.impacts)void 0!==a.data.stats[v]&&(a.data.stats[v]+=S.impacts[v]);if(S.temp){var _=S.duration||"PT0M",w=s(g.when||a.data.current_time,_),A={what:g.what,key:m,impacts:S.impacts,expiry:w,when:g.when||a.data.current_time};a.data.current_side_effects.push(A),a.data.current_side_effects.sort(function(e,t){return new Date(e.expiry)-new Date(t.expiry)}),u.push("Effect applied: "+g.what)}}}var R="## What MUST Happen and What MUST NOT Happen\n\n**The in-game date/time when the current turn starts (at the beginning of\nyour current response) is : {{CURRENT_TIME}}**.\n".replace("{{CURRENT_TIME}}",c(a.data.current_time)),E=r.summaryData||{},M=l.standardizedFunctions,N="";if(M&&Array.isArray(M))for(var C in E)for(var I=E[C],O=0;O<M.length;O++)try{var D=M[O](a,C,I,d);if(D){N+=D+"\n";break}}catch(e){console.error("Standardized function failed for key "+C+":",e),e.toString().includes("rollxdy is not defined")&&(N+="[System Error: Script function failed]\n")}R+=N;var U=n(JSON.stringify(a.data),h.secretKey),b='## HOW TO CONSTRUCT [NARRATION_SUMMARY] BLOCK\n\nThe JSON object MUST contain \'elapsed_duration\' in ISO 8601 duration format (e.g., "PT5M" for 5 minutes or "P1DT2H" for 1 day and 2 hours).\n\nAdditionally, strictly follow the following rules for specified events:\n',x=l.summaryTemplate;for(var Y in x){var P=x[Y],k={what:P.what,when:P.when,temp:P.temp,impacts:P.impacts,duration:P.duration};b+="\n   ".concat(P.free_text||"","\n   key: ").concat(Y,"\n   value: ").concat(JSON.stringify(k,null,2),"\n   ")}var J="[SYSTEM INSTRUCTION]\n1. ALWAYS start your response with the [SCRIPT_SECRET] block given in the latest instruction verbatim.\n2. ALWAYS align your narration with [NARRATION_GUIDE] block. NEVER contradict or conflict with any part of it.\n3. ALWAYS end your response with the [NARRATION_SUMMARY] block with updated summarized information on what happened in the narration in your current response.\n[/SYSTEM INSTRUCTION]\n    \n\n\n"+"[NARRATION_GUIDE]\n${narrationGuide} \n[/NARRATION_GUIDE]\n".replace("${narrationGuide}",R)+"\n"+"REQUIREMENTS:\n  1. You MUST start your response with the following encrypted state \n     block exactly as is (**MUST BE VERBATIM**):\n     [SCRIPT_SECRET]${nextSecret}[/SCRIPT_SECRET]\n  2. At the end of your response, you MUST include a \n     [NARRATION_SUMMARY]...[/NARRATION_SUMMARY] JSON block.\n".replace("${nextSecret}",U)+"\n"+"Here is how to construct it: \n${narrationSummary}\n".replace("${narrationSummary}",b);e.character.scenario+=J}(context)})()})();